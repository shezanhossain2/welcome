---
- name: Generate
  hosts: sw
  connection: network_cli
  gather_facts: false
  
  collections:
    - community.network


  tasks:
    - name: Create a file new3_file.txt and push to GitHub
      block:
        - name: Show config
          community.network.exos_command:
            commands: show config
          register: config

        - name: SAVE OUTPUT TO ./backups/
          copy:
            content: "{{ config.stdout[0] }}"
            dest: "/tmp/{{ inventory_hostname }}.txt"
          delegate_to: localhost
          become: false

        - name: Add exception for /tmp directory in Git
          command: git config --global --add safe.directory /tmp
          when: not ansible_check_mode

        - name: push to git
          ignore_errors: true
          shell: "{{ item }}"
          args: 
            chdir: /tmp
          loop: 
            - git config --global user.name "shezanhossain2"
            - git config --global user.email hossainmahmudshezan@gmail.com
            - git init
            - git add *
            - git commit -m "{{inventory_hostname}}"
            - git branch -M master
            - git remote add origin https://{{token_key}}@github.com/{{user_name}}/fresh.git
            - git push origin master
          delegate_to: localhost
          become: false